server {
    index index.php index.html;
    server_name localhost;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    root /var/www/html;

    location /player {
        rewrite ^/player/(.*)/games_played$ /players/show_user_games_played.php?player=$1;
        rewrite ^/player/(.*)/games_modded$ /players/show_user_games_modded.php?player=$1;
        rewrite ^/player/(.*)/with$ /players/show_played_with.php?player=$1;
        rewrite ^/player/(.*)/with/(.*)$ /players/show_played_with.php?player=$1&player2=$2;
        rewrite ^/player/(.*)$ /players/show_player_stats.php?player=$1;
    }

    location /profile {
        rewrite ^/profile/(.*)$ /players/show_player_profile.php?player=$1;
    }

    location /game {
        rewrite ^/game/(.*)/votes$ /show_game_votes.php?thread_id=$1;
        rewrite ^/game/(.*)/votes/xml$ /show_game_votes_xml.php?thread_id=$1;
        rewrite ^/game/(.*)/tally_inverted$ /show_game_tally_inverted.php?thread_id=$1;
        rewrite ^/game/(.*)/tally$ /show_game_tally.php?thread_id=$1;
        rewrite ^/game/(.*)/chat$ /game_chat.php?thread_id=$1;
        rewrite ^/game/(.*)/chat/room=(.*)$ /game_chat.php?thread_id=$1&go_to_room=$2;
        rewrite ^/game/(.*)/chat/tab=(.*)$ /game_chat.php?thread_id=$1&tab=$2;
        rewrite ^/game/(.*)/(.*)$ /get_user_post.php?thread_id=$1&player=$2;
        rewrite ^/game/(.*)$ /show_game_stats.php?thread_id=$1;
    }

    location /competition {
        rewrite ^/competition/game/(.*)/(.*)$ /get_user_post.php?thread_id=$1&player=$2;
        rewrite ^/competition/game/(.*)$ /competition/cc_show_game_stats.php?thread_id=$1;
    }

    location /chat {
        rewrite ^(.*)$ /chat.php;
    }

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}
