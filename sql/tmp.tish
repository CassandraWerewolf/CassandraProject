Tally_display_lhlv.sql:create or replace view Tally_display_lhlv as SELECT game_id, day, votee, sum(if(unvoted='Yes',0,1)) as total,group_concat(if(unvoted='Yes',concat('[-]',concat(voter,'(',vote_count,')'),'[/-]'), concat(voter,if(nightfall='Yes','*',''),'(',vote_count,')')) order by vote_count separator ', ') as votes_bgg, group_concat(if(unvoted='Yes',concat('<strike>',concat(voter,'(',vote_count,')'),'</strike>'), concat(voter,if(nightfall='Yes','*',''),'(',vote_count,')')) order by vote_count separator ', ') as votes_html from Tally_votes group by game_id, day, votee order by game_id, day, total desc, max(if(unvoted='Yes',NULL,vote_count)) asc
Tally_display_lhv.sql:create or replace view Tally_display_lhv as SELECT game_id, day, votee, sum(if(unvoted='Yes',0,1)) as total, group_concat(if(unvoted='Yes',concat('[-]',concat(voter,'(',vote_count,')'),'[/-]'),concat(voter,if(nightfall='Yes','*',''),'(',vote_count,')')) order by vote_count separator ', ')as votes_bgg, group_concat(if(unvoted='Yes',concat('<strike>',concat(voter,'(',vote_count,')'),'</strike>'),concat(voter,if(nightfall='Yes','*',''),'(',vote_count,')')) order by vote_count separator ', ')as votes_html from Tally_votes group by game_id, day, votee order by game_id, day, total desc, min(if(unvoted='Yes',NULL,vote_count)) asc
Tally_votes.sql:create or replace view Tally_votes as (select Tally.game_id AS game_id,Tally.day AS day,u1.name AS voter,u2.name AS votee,Tally.vote_count AS vote_count,if((Tally.unvote = 0),'No','Yes') AS unvoted,if((Tally.nightfall = 0),'No','Yes') AS nightfall,Tally.vote_article AS vote_article,Tally.unvote_article AS unvote_article,Tally.nightfall_article AS nightfall_article from Tally, Users u1, Users u2 where Tally.voter = u1.id and Tally.votee = u2.id)
Tally_votes.sql:(select Tally.game_id AS game_id,Tally.day AS day,u1.name AS voter,Tally.misc AS votee,Tally.vote_count AS vote_count,if((Tally.unvote = 0),'No','Yes') AS unvoted,if((Tally.nightfall = 0),'No','Yes') AS nightfall,Tally.vote_article AS vote_article,Tally.unvote_article AS unvote_article,Tally.nightfall_article AS nightfall_article from Tally, Users u1 where Tally.voter = u1.id and Tally.votee = 0) order by game_id,day,vote_count
Votes_bi_trigger.sql:set new_count := (select max(vote_count) from Tally where game_id = new.game_id and day = new.day);
Votes_bi_trigger.sql:	set tally_id := (select id from Tally where Tally.game_id=new.game_id and Tally.day=new.day and Tally.voter=new.voter and Tally.unvote=0);
Votes_bi_trigger.sql:		insert into Tally(game_id, day, votee, voter, vote_article, vote_count,misc) Values(new.game_id, new.day, new.votee, new.voter,new.article_id, new_count,new.misc);
Votes_bi_trigger.sql:	set tally_id := (select id from Tally where Tally.game_id=new.game_id and Tally.day=new.day and Tally.voter=new.voter and Tally.votee = new.votee and Tally.unvote=0 and Tally.nightfall=0);
Votes_bi_trigger.sql:		update Tally set Tally.unvote=1, Tally.unvote_article=new.article_id where Tally.game_id=new.game_id and Tally.day=new.day and Tally.voter=new.voter and Tally.unvote=0 and Tally.nightfall=0;
